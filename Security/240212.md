#### 240212

## Security Architecture

![Alt Text](./img/240212_1.png)

1. SecurityConfigì— ì§€ì •í•œ ê²ƒë“¤ì€ Filterê°€ ë˜ì–´, init ì‹œ FilterChainProxyì— ë“¤ì–´ê°„ë‹¤.

2. ì‚¬ìš©ìì˜ ìš”ì²­ì„ DelegatingFilterProxyê°€ ì œì¼ ë¨¼ì € ë°›ê³ , filterChain Beanì´ ìˆë‹¤ë©´ ì´ë¥¼ FilterChainProxyì— ìœ„ì„í•œë‹¤.

3. SecurityContextì— ì¸ì¦ ê°ì²´ê°€ ìˆëŠ”ì§€ ë³´ê³ , ì—†ë‹¤ë©´ ì¸ì¦ ê°ì²´ ìƒì„±í•œë‹¤.

4. AuthProviderëŠ” ì‚¬ìš©ìì˜ id/pwë¥¼ UserDetailsServiceë¥¼ í†µí•´ ì¡°íšŒ í›„, ì™„ë£Œ ì‹œ ì¸ì¦ ê°ì²´ë¥¼ Contextì— ë„£ì–´ì¤€ë‹¤.

5. ë™ì¼ ì„¸ì…˜ì´ ì—¬ëŸ¬ê°œ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ í›„, ìˆë‹¤ë©´ ì˜ˆì™¸ì²˜ë¦´ í•´ì¤€ë‹¤.

6. ì´í›„ ì ‘ê·¼í•˜ê³ ì í•˜ëŠ” ìì›ì— ëŒ€í•´, ì¸ê°€ í•„í„°ê°€ ì‘ìš©í•œë‹¤.

> ì •ì  ìì›(CSS, js, images)ëŠ” ë³´ì•ˆ í•„í„°ë¥¼ ê±°ì¹˜ì§€ ì•Šë„ë¡ ì˜ˆì™¸ì²˜ë¦¬ í•´ì¤˜ì•¼ í•œë‹¤.

### ì‹¤ì „ êµ¬í˜„ Point

![Alt Text](./img/240212_2.png)

- AccountDTO
```
@Data
public class AccountDto {
    private String username;
    private String password;
    private String email;
    private String age;
    private String role;
}
```

- UserRepository
```
public interface UserRepository extends JpaRepository<Account, Long> {
}
```

- UserService, UserServiceImpl
```
public interface UserService {
    void createUser(Account account);
}
```

```
@Service("userService") // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” Component Bean, ë£¨íŠ¸ ì»¨í…Œì´ë„ˆì— ë‹´ê¹€
public class UserServiceImpl implements UserService {

    @Autowired
    private UserRepository userRepository;

    @Transactional // í•´ë‹¹ ë©”ì†Œë“œê°€ Lock ë³´ì¥ì´ ëœë‹¤ëŠ” ì˜ë¯¸
    @Override
    public void createUser(Account account){
        userRepository.save(account);
    }
}
```

- 1. [domain] JPAì— ë‹´ê¸¸ Data Class ìƒì„±, Entityì™€ Id, GenVal ì„¤ì •í•´ì•¼ JPAì— ë‹´ê¸¸ í…Œì´ë¸” í´ë˜ìŠ¤ë¼ëŠ”ê±¸ ì•Œ ìˆ˜ ìˆë‹¤. (ì—”í„°í‹° í´ë˜ìŠ¤)

- 2. [repository] JpaRepo í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì„ interface ìƒì„±í•œë‹¤. ì´ë•Œ, ìœ„ domainì— ì—”í„°í‹° í´ë˜ìŠ¤ë¥¼ ë“±ë¡í•œë‹¤.
    * IF ì‚¬ìš© ì¥ì  : ë‹¤ì¤‘ ìƒì† ê°€ëŠ¥, 
    * IFì˜ ëª¨ë“  ë©¤ë²„ ë³€ìˆ˜ëŠ” public static final
    * ë©”ì†Œë“œëŠ” public abstractì´ë‹¤.

```
ì ‘ê·¼ ì œì–´ì : public > protected > default > private

public : íŒ¨í‚¤ì§€ì— ìƒê´€ì—†ì´ ëª¨ë“  í´ë˜ìŠ¤ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
default : ê°™ì€ íŒ¨í‚¤ì§€ ì•ˆì˜ í´ë˜ìŠ¤ë§Œ ì ‘ê·¼ ê°€ëŠ¥
private : ê°™ì€ í´ë˜ìŠ¤ ì•ˆì— ìˆëŠ” ë©¤ë²„ë§Œ ì ‘ê·¼ ê°€ëŠ¥
protected : ê°™ì€ íŒ¨í‚¤ì§€ ì•ˆì˜ ëª¨ë“  í´ë˜ìŠ¤ì™€ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ì˜ ìì‹ í´ë˜ìŠ¤ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥

ì¶”ìƒ í´ë˜ìŠ¤ : ë¶€ëª¨ í´ë˜ìŠ¤ê°€ ê°€ì§„ ê¸°ëŠ¥ì„ ë‹¤ë¥´ê²Œ êµ¬í˜„í•´ì•¼ í•  ë•Œ
- ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ì˜ ê³µí†µì ì¸ ë¶€ë¶„ì„ ì¶”ìƒí™” ì‹œí‚¤ëŠ”ë° ëª©ì 
- ìŠˆí¼ í´ë˜ìŠ¤ì˜ ê¸°ëŠ¥ ì´ìš© ë° í™•ì¥ì„ ìœ„í•´ ì‚¬ìš©

// ì¶”ìƒ í´ë˜ìŠ¤ (ì¡°ìƒ í´ë˜ìŠ¤)
abstract class Creature { 
	abstract void swimming(); // ìˆ˜ì˜ ë™ì‘ì„ í•˜ëŠ” ì¶”ìƒ ë©”ì†Œë“œ
}

// ì¶”ìƒ í´ë˜ìŠ¤ (ë¶€ëª¨ í´ë˜ìŠ¤)
abstract class Animal extends Creature { }
abstract class Fish extends Creature { }

// ìì‹ í´ë˜ìŠ¤
class Parrot extends Animal {
	void swimming() {} // ì•µë¬´ìƒˆëŠ” ìˆ˜ì˜ì„ í• ìˆ˜ ì—†ì§€ë§Œ ìƒì† ê´€ê³„ë¡œ ì¸í•´ ê°•ì œì ìœ¼ë¡œ ë©”ì†Œë“œë¥¼ êµ¬í˜„í•´ì•¼í•˜ëŠ” ì‚¬íƒœê°€ ì¼ì–´ë‚œë‹¤.
}
class Tiger extends Animal {
	void swimming() {} // í˜¸ë‘ì´ëŠ” ìˆ˜ì˜ì„ í• ìˆ˜ ì—†ì§€ë§Œ ìƒì† ê´€ê³„ë¡œ ì¸í•´ ê°•ì œì ìœ¼ë¡œ ë©”ì†Œë“œë¥¼ êµ¬í˜„í•´ì•¼í•˜ëŠ” ì‚¬íƒœê°€ ì¼ì–´ë‚œë‹¤.
}
class People extends Animal {
	void swimming() {
    	// ...
    } 
}

class Whale extends Fish {
	void swimming() {
		// ...
    } 
}

ì¶œì²˜: https://inpa.tistory.com/entry/JAVA-â˜•-ì¸í„°í˜ì´ìŠ¤-vs-ì¶”ìƒí´ë˜ìŠ¤-ì°¨ì´ì -ì™„ë²½-ì´í•´í•˜ê¸° [Inpa Dev ğŸ‘¨â€ğŸ’»:í‹°ìŠ¤í† ë¦¬]

ì¸í„°í˜ì´ìŠ¤ : ê·¸ë•Œ ê·¸ë•Œ í•„ìš”ì— ë”°ë¼ êµ¬í˜„í•˜ì—¬ ììœ ë¡­ê²Œ ë¶™ì˜€ë‹¤ ë—ë‹¤ í•˜ëŠ” ëŠë‚Œ. êµ¬í˜„ì²´ì˜ ë™ì¼í•œ ë™ì‘ì„ ì•½ì†í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.

abstract class Creature { }

abstract class Animal extends Creature { }
abstract class Fish extends Creature { }

// ìˆ˜ì˜ ë™ì‘ ì¶”ìƒ ë©”ì†Œë“œë¥¼ ë”°ë¡œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ë„£ëŠ”ë‹¤.
interface Swimmable {
    void swimming();
}

class Tiger extends Animal { }
class Parrot extends Animal { }
class People extends Animal implements Swimmable{ // ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•¨ìœ¼ë¡œì¨ ë™ì‘ì´ í•„ìš”í•œ í´ë˜ìŠ¤ì—ë§Œ ë”°ë¡œ ìƒì†ì— êµ¬ì• ë°›ì§€ì•Šê³  ë¬¶ìŒ
    @Override
    public void swimming() {}
}

class Whale extends Fish implements Swimmable{ // ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•¨ìœ¼ë¡œì¨ ë™ì‘ì´ í•„ìš”í•œ í´ë˜ìŠ¤ì—ë§Œ ë”°ë¡œ ìƒì†ì— êµ¬ì• ë°›ì§€ì•Šê³  ë¬¶ìŒ
    @Override
    public void swimming() {}
}
ì¶œì²˜: https://inpa.tistory.com/entry/JAVA-â˜•-ì¸í„°í˜ì´ìŠ¤-vs-ì¶”ìƒí´ë˜ìŠ¤-ì°¨ì´ì -ì™„ë²½-ì´í•´í•˜ê¸° [Inpa Dev ğŸ‘¨â€ğŸ’»:í‹°ìŠ¤í† ë¦¬]

```
- 3. [service] ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•  ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.
    * ì‹¤ì œ ìˆ˜í–‰í•  Impl í´ë˜ìŠ¤ ìƒì„±í•˜ê³ , Overrideë¥¼ í†µí•´ êµ¬í˜„í•œë‹¤.

- 4. ì–´ë–¤ ë¶€ë¶„ì„ Override í• ê¹Œ?

    * A. CustomUserDetailsService ì—ì„œ ìœ ì €ì˜ ì •ë³´ì™€ ê¶Œí•œì„ ê°ìì˜ DBì—ì„œ ì–»ì–´ì˜¤ëŠ” ê³¼ì • êµ¬í˜„ (ì‚¬ìš©ì ì´ë¦„ì´ ì‹¤ì œ DB Tableì— ìˆëŠ”ì§€ ì¡°íšŒí•˜ê³ , ìˆë‹¤ë©´ ê·¸ ìœ ì €ê°€ ê°€ì§„ Roleì„ Listì— ë‹´ì•„ ë°˜í™˜)

    * B. CustomAuthenticationProvider ì—ì„œ Password ì¼ì¹˜ ì—¬ë¶€ í™•ì¸ í›„, ë§ë‹¤ë©´ ì¸ì¦ ê°ì²´ë¥¼ ë°˜í™˜

    * C. ë¡œê·¸ì¸ í˜ì´ì§€ êµ¬ì„± ë° ë¡œê·¸ì•„ì›ƒì´ë‚˜ ê¶Œí•œ ë³„ í˜ì´ì§€ ë¡œë”©, 

    * D. ì¸ì¦ ì„±ê³µ ë° ì‹¤íŒ¨ ì‹œ ë™ì‘, ì¸ì¦ ê±°ë¶€ ë™ì‘ ì¡°ê±´ë“¤

----



### Spring MVC êµ¬ì¡° ì´í•´

 - ì°¸ì¡° : https://codevang.tistory.com/248

 - 1. í†°ìº£(WAS, Servlet Container) êµ¬ë™
    * server.xml ë‚´ë¶€ ì„¤ì •ê°’ë“¤ì— ëŒ€í•œ ìš”ì²­ì„ ì œì¼ ë¨¼ì € ë°›ëŠ”ë‹¤.

 - 2. ë£¨íŠ¸ ì»¨í…Œì´ë„ˆ ìƒì„± (WEB-INF/web.xml, ì–´í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸)
    * ì»¨í…Œì´ë„ˆì˜ ì¢…ë¥˜ : (ë£¨íŠ¸ ì»¨í…Œì´ë„ˆ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ, ì»¤ìŠ¤í…€ ì»¨í…Œì´ë„ˆ)

    * ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” ë£¨íŠ¸ ì»¨í…Œì´ë„ˆì˜ ìì‹ì´ë‹¤.

    * ì‹¤ì œ ë£¨íŠ¸ ì»¨í…Œì´ë„ˆ êµ¬ë™ ì‹œ, ìƒì„±ê³¼ ì†Œë©¸ ì£¼ê¸°ë¥¼ Overrideí•˜ì—¬ ì›í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë„ë¡ êµ¬ì„±(JNI)ë˜ì–´ ìˆë‹¤.

 - 3. servlet-context.xml (ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ)ëŠ”, íŠ¹ì • urlì— ì•Œë§ëŠ” Dispatcher-Servletì„ ìƒì„±í•œë‹¤. ì„œë¸”ë¦¿ êµ¬ë™ ì‹œ íŒŒë¼ë¯¸í„°ê°€ servlet-context.xmlì´ë¼ê³  ë³´ë©´ ëœë‹¤.

 - ìš”ì²­ ì¸ì… ì‹œ, urlì— ë§¤í•‘ëœ ì„œë¸”ë¦¿ì„ ë©”ëª¨ë¦¬ì— ë¡œë“œì‹œí‚¨ë‹¤.
 - ìš”ì²­ í•˜ë‚˜ ë‹¹ ìŠ¤ë ˆë“œë¡œ ì²˜ë¦¬í•˜ë©°, ìŠ¤ë ˆë“œí’€ì€ WASì—ì„œ ìì²´ê´€ë¦¬í•œë‹¤.

----

### Bean ê°ì²´

 - @Controller ì‹œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆì— Bean ìƒì„±ë¨, ì›¹ ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬ìš©
 - @Repository : DBë‚˜ íŒŒì¼ê°™ì€ I/O ì‘ì—… ì²˜ë¦¬, ë£¨íŠ¸ ì»¨í…Œì´ë„ˆ ìƒì„±
 - @Service : ë¡œì§ ì²˜ë¦¬ìš©,  ë£¨íŠ¸ ì»¨í…Œì´ë„ˆì— ìƒì„±ë¨
 - Bean ê°ì²´ëŠ” ë°ì´í„° ë³€ê²½ì´ ì—†ëŠ” ê°ì²´ë¡œ ì‚¬ìš©í•œë‹¤. (VO, DTO ê°ì²´ëŠ” ë“±ë¡í•˜ì§€ ì•ŠìŒ, ë™ê¸°í™” ì´ìŠˆ)

 - Beanìœ¼ë¡œ ë“±ë¡í•´ ë‘ë©´, newë¡œ ìƒì„±í•˜ë©´ ì•ˆë˜ê³  ì»¨í…Œì´ë„ˆì—ì„œ ë°›ì•„ì™€ì•¼ í•œë‹¤. ì „ì²´ ê³µìœ ê°€ ê°€ëŠ¥í•˜ê¸°ì—, ì˜ì¡´ì„± ì£¼ì…(DI, @Autowired)ë¡œ ê°ì²´ë¥¼ ë°›ì•„ì™€ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

 ```
 @Autowired
 private UserService userService; // Service ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ë“±ë¡í•œ Bean ê°ì²´(ì „ì—­)ì„ ë°›ì•„ì™€ ì“¸ ìˆ˜ ìˆë‹¤.
 ```

 > ë£¨íŠ¸ ì»¨í…Œì´ë„ˆë‚˜ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ ìƒì„± ì‹œ, ì–´ë…¸í…Œì´ì…˜ ê²€ìƒ‰í•˜ê¸°ë•Œë¬¸ì— ì°¸ì¡° xml íŒŒì¼ì— component-scan ë²”ìœ„ê°€ ë§ëŠ”ì§€ í™•ì¸í•´ì•¼ í•œë‹¤.

-----

### OOPì˜ íŠ¹ì§•
 
 - ì¶œì²˜ : https://sohyeonnn.tistory.com/37#:~:text=%E2%97%BC%20%EC%99%9C%20%ED%81%B4%EB%9E%98%EC%8A%A4%EB%8A%94%20%EB%8B%A8%EC%9D%BC,%EB%A7%8C%20%ED%95%98%EA%B3%A0%20%EC%9E%88%EA%B8%B0%20%EB%95%8C%EB%AC%B8%EC%9E%85%EB%8B%88%EB%8B%A4.

 - ìƒì†, ìº¡ìŠí™”, ë‹¤í˜•ì„±, ì¶”ìƒí™”
 - ì¬ì‚¬ìš©ì„± ìš©ì´ : ì´ë¯¸ ì‚¬ìš©í•œ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì•„ ìˆ˜ì • ê°€ëŠ¥
 - ë©”ëª¨ë¦¬ ì‚¬ìš©ê³¼ CPU ì‹œê°„ì´ ëŠë¦¼ (ì ˆì°¨ ì§€í–¥ì— ë¹„í•´)

> ì¶”ìƒí™”
 - ì¶”ìƒ í´ë˜ìŠ¤ì™€ ì¸í„°í˜ì´ìŠ¤ ì¡´ì¬.

> ìº¡ìŠí™”
 - ë°ì´í„° ë³´í˜¸ë¥¼ ìœ„í•œ ê²ƒ

> ìƒì†
 - ê¸°ì¡´ í´ë˜ìŠ¤ ì¬í™œìš©

> ë‹¤í˜•ì„±
 - 

### Ajax ì¸ì¦

 - Login ì¸ì¦ ë°©ì‹ì€ ë™ê¸°ì‹ ì²˜ë¦¬ì§€ë§Œ, AjaxëŠ” ë¹„ë™ê¸°ì‹ ë°©ì‹ì´ë‹¤.

### JWT ì¸ì¦

 - ì¸ì¦ ì •ë³´ë¥¼ ì„¸ì…˜ì— ë‹´ì§€ ì•Šê³ , í† í°ì— ë‹´ì•„ í‘œì¶œí•˜ëŠ” ë°©ì‹.

### Oauth2, JWT, ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ ì¸ì¦(Spring Cloud Security)
### ACL (Access Control List)




